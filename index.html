<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="index.css" />
<meta charset="UTF-8">
<title>Maze</title>
<script>
	var curMaze;

	function loadMaze() {
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "maze.php", true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				curMaze = ajax.responseText
				document.getElementById('maze').innerHTML = curMaze;

			}
		}
	}

	function checkKey(e) {
		e = e || window.event;
		var ajax = new XMLHttpRequest();
		if (e.keyCode == '38') {
			// up arrow
			ajax.open("GET", "maze.php?up=", true);
		} else if (e.keyCode == '40') {
			// down arrow
			ajax.open("GET", "maze.php?down=", true);
		} else if (e.keyCode == '37') {
			// left arrow
			ajax.open("GET", "maze.php?left=", true);
		} else if (e.keyCode == '39') {
			// right arrow
			ajax.open("GET", "maze.php?right=", true);
		} else {
			return;
		}
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				if (ajax.responseText != curMaze) {
					curMaze = ajax.responseText;
					moveCounter();
					document.getElementById('maze').innerHTML = curMaze;
				}
			}
		}
	}

	function moveCounter() {
		sessionStorage.setItem("MAZE_MOVES", parseInt(sessionStorage
				.getItem("MAZE_MOVES")) + 1);
		document.getElementById('count').innerHTML = 'Count: '
				+ sessionStorage.getItem("MAZE_MOVES");
	}

	function loadCounter() {
		if (typeof sessionStorage.getItem("MAZE_MOVES") == "NaN") {
			sessionStorage.setItem("MAZE_MOVES", 0);
		}
		document.getElementById('count').innerHTML = 'Move Count: '
				+ sessionStorage.getItem("MAZE_MOVES");
	}

	document.onkeydown = checkKey;
	window.onload = function() {
		loadMaze();
		loadCounter();
	}
</script>
</head>
<body>
	<div id="header">
		<div>
			<h1>Maze</h1>
		</div>
	</div>

	<div id='content' class='content'>
		<div class='leftPanel'>			
			<div id='maze' class='maze'></div>
			<button type="button">Click Me!</button>
		</div>
		<div class='rightPanel'>
			<div id='count' class='count'></div>
			<div id='scores'></div>
		</div>
	</div>
</body>
</html>