<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="index.css" />
<meta charset="UTF-8">
<title>Maze</title>
<script>
	//Global variables 
	var curMaze;
	
	// initial page load maze from previos session if one exists or create one
	function loadMaze() {
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "maze.php", true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				curMaze = ajax.responseText
				document.getElementById('maze').innerHTML = curMaze;

			}
		}
	}
	
	// initial page load counter from previos session if one exists or create one
	function loadCounter() {
		if (sessionStorage.getItem("MAZE_MOVES") == "NaN" || "null") {
			sessionStorage.setItem("MAZE_MOVES", 0);
		}
		document.getElementById('count').innerHTML = 'Move Count: '
				+ sessionStorage.getItem("MAZE_MOVES");
	}
	
	
///////////// SCOTT  ///////////
	//USAGE = if no variable is passed in the url then load then return the scoreboard from the database (occurs on inital page load)
	// if username and count variable are set in url when scoreboard.php is called then process the game data and return the updated scoreboard as HTML.
	function loadScoreboard() {
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "scoreboard.php", true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				document.getElementById('scores').innerHTML = ajax.responseText;
			}
		}
	}
	
	
	///////////// SCOTT  ///////////
	//USAGE = if no variable is passed in the url then load then return the scoreboard from the database (occurs on inital page load)
	// if username and count variable are set in url when scoreboard.php is called then process the game data and return the updated scoreboard as HTML.
	function onWin(username, moveCount) {
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "scoreboard.php?username=" + username + '&count=' + parseInt(moveCount), true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				document.getElementById('scores').innerHTML = ajax.responseText;
			}
		}
	}
	
	///////////// SCOTT - when the php script is called with no varables set then 
	/////////////         check if logged in $_SESSION['login'] == 1 if so return HTML welcome message
	/////////////		  else return HTML code back of login form///////////
	function loadLogin() {
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "login.php", true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				document.getElementById('login').innerHTML = ajax.responseText;
			}
		}
	}
	
	///////////// SCOTT - function should be called on register button press///////////
	function onRegister() {
		//UNFINISHED - Get username and pass from form and set variable for below code		
		//
		//
		//
		//////////////////////////////////////////////////////////////////////////////
		
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "login.php?register=" + username + "&pass=" + password, true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				document.getElementById('login').innerHTML = ajax.responseText;
			}
		}
	}
	
	///////////// SCOTT - function should be called on login button press///////////
	function onLogin() {
		//UNFINISHED - Get username and pass from form and set variable for below code
		//
		//
		//
		//////////////////////////////////////////////////////////////////////////////
		
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "login.php?login=" + username + "&pass=" + password, true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				document.getElementById('login').innerHTML = ajax.responseText;
			}
		}
	}
	

	// Key Press Event Handler
	function checkKey(e) {
		e = e || window.event;
		var ajax = new XMLHttpRequest();
		if (e.keyCode == '38') {
			// up arrow
			ajax.open("GET", "maze.php?up=", true);
		} else if (e.keyCode == '40') {
			// down arrow
			ajax.open("GET", "maze.php?down=", true);
		} else if (e.keyCode == '37') {
			// left arrow
			ajax.open("GET", "maze.php?left=", true);
		} else if (e.keyCode == '39') {
			// right arrow
			ajax.open("GET", "maze.php?right=", true);
		} else {
			return;
		}
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				if (ajax.responseText != curMaze) {
					curMaze = ajax.responseText;
					moveCounter();
					document.getElementById('maze').innerHTML = curMaze;
				}
			}
		}
	}

	// keeps count of total spaces moved
	function moveCounter() {
		sessionStorage.setItem("MAZE_MOVES", parseInt(sessionStorage
				.getItem("MAZE_MOVES")) + 1);
		document.getElementById('count').innerHTML = 'Move Count: '
				+ sessionStorage.getItem("MAZE_MOVES");
	}
	
	// function called when new game button click event occurs
	function newGame() {
		//clear counter
		sessionStorage.clear();
		loadCounter();
		
		//clear maze and load new 
		var ajax = new XMLHttpRequest();
		ajax.open("GET", "maze.php?new=", true);
		ajax.send();
		ajax.onreadystatechange = function() {
			if (ajax.readyState == 4 && ajax.status == 200) {
				curMaze = ajax.responseText
				document.getElementById('maze').innerHTML = curMaze;

			}
		}
	}
	
	document.onkeydown = checkKey;
	window.onload = function() {
		loadLogin();
		loadMaze();
		loadCounter();
		loadScoreboard();
	}
</script>
</head>
<body>
	<div id="header">
		<div>
			<h1>Maze</h1>
		</div>
		<div id='login' class='login'> </div>
	</div>

	<div id='content' class='content'>
		<div class='leftPanel'>			
			<div id='maze' class='maze'></div>
			<button type="button" onclick='newGame()'>New Game</button>
		</div>
		<div class='rightPanel'>
			<div id='count' class='count'></div>
			<div id='scores'></div>
		</div>
	</div>
</body>
</html>